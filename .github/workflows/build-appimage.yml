name: Build AppImage
on:
  push:
    branches:  
    - main
  pull_request:
    branches:
    - "*"
jobs:
  appimage:
    name: Build AppImage
    runs-on: ${{ matrix.os }}
    container: docker
    strategy:
      fail-fast: false
      matrix:
        include:
        - os: ubuntu-latest
          platform: Linux
          arch:
            - x86_64
        - os: ubuntu-latest
          arch:
            - aarch64
    steps:
    - uses: actions/checkout@v4
    - name: Build AppImage
      run: |
        docker build -t appimage-builder --build-arg="ARCHITECTURE=${{ matrix.arch }}" . -f burrow-gtk/build-aux/Dockerfile
        docker create --name temp appimage-builder
        docker cp temp:/app/burrow-gtk/build-appimage/Burrow-x86_64.AppImage .
        docker rm temp
    - uses: actions/upload-artifact@v4
      name: Upload to GitHub
      with:
        name: AppImage
        path: Burrow-${{ matrix.arch }}.AppImage
